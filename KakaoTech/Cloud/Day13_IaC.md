# IaC - Infrastructure As Code

## 개요

Infrastructure as Code(IaC)는 서버, 네트워크, 데이터베이스, 애플리케이션 구성을 수동으로 관리하는 대신 코드로 정의하고 관리하는 방법입니다. 이를 통해 IT 인프라를 효율적으로 배포하고 관리할 수 있습니다.

## 사용하는 이유

1. **자동화 및 일관성**: 수동 설정의 오류를 줄이고 인프라 배포 및 관리의 일관성을 유지합니다.
2. **버전관리**: 코드로 작성되어 Git을 통해 변경 이력을 추적하고 복구할 수 있습니다.
3. **재사용성**: 코드 모듈화와 템플릿화를 통해 재사용성을 높입니다.
4. **협업**: 여러 개발자가 동시에 작업할 수 있습니다.
5. **가시성 및 투명성**: 코드만 읽어도 인프라 구성 상태를 파악할 수 있습니다.

## 구현 방식

### 선언적 접근 방식

- 최종 상태를 정의하고 시스템이 그 상태대로 자동으로 구성되도록 합니다.
- 장점: 코드만 봐도 무엇이 배포될지 알 수 있으며 명령어 하나로 상태를 비교할 수 있습니다.
- 단점: 코드로 완벽하게 배포되지 않으면 하나도 배포되지 않으며, 진입장벽이 높습니다.
- 예시: Terraform, AWS CloudFormation, Kubernetes YAML

### 명령적 접근 방식

- 원격지에서 명령을 실행할 수 있게 구성합니다.
- 예시: Ansible, Chef, Puppet

## IaC 도구

### Terraform

- **선언적 접근 방식**으로 클라우드 인프라를 코드로 정의합니다.
- 주요 특징:
    - 여러 클라우드 서비스 제공자 지원(AWS, Azure, GCP 등)
    - HCL(HashiCorp Configuration Language) 사용
    - 실행 계획을 통해 변경 사항을 적용 전 미리 계획 파악
    - 모듈화를 통해 코드 재사용성 증가

### Ansible

- **명령적 접근 방식**으로 서버 구성 및 애플리케이션 배포를 자동화합니다.
- 주요 특징:
    - 에이전트 설치 필요 없음 (SSH 사용)
    - 다양한 모듈을 통해 다양한 작업 수행
    - YAML 언어 사용으로 가독성 높음

## Terraform 구성 요소

- **Providers**: 클라우드 서비스 제공자와의 인터페이스
- **Resource**: 클라우드 자원
- **Variables**: 변수 사용으로 코드 재사용성 증가
- **Outputs**: 출력 값을 정의하여 다른 구성 요소와 연계
- **Modules**: 코드의 재사용을 위해 모듈화

### Terraform 워크플로우

1. `terraform init`: 초기화
2. `terraform plan`: 계획 수립
3. `terraform apply`: 적용
4. `terraform state`: 상태 관리
5. `terraform destroy`: 종료

## Ansible 구성 요소

- **Inventory**: 관리할 호스트 목록 정의
- **Playbooks**: 작업 정의서 (YAML 형식)
- **Tasks**: 실행할 작업 정의
- **Modules**: 특정 작업을 수행하는 모듈
- **Roles**: 관련 작업을 그룹화하여 재사용
- **Handler**: 특정 조건에 따라 실행
- **Templates**: Jinja2 템플릿을 통해 설정 파일 생성

### Ansible 워크플로우

1. 인벤토리 작성: 관리할 호스트 목록 작성
2. 플레이북 작성: 수행할 작업을 정의한 YAML 파일 작성
3. 작업 실행: `ansible-playbook` 명령어로 플레이북 실행
4. 상태 확인: `ansible` 명령어로 호스트 상태 확인 및 관리

## 결론

Terraform은 주로 인프라를 구성하는 데 사용되고, Ansible은 구성된 인프라에 애플리케이션을 배포하는 데 사용됩니다. 둘을 함께 사용하는 경우가 많지만, Ansible만 단독으로 사용하는 경우도 있습니다.
